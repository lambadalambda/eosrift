{
	# Optional (recommended): set via EOSRIFT_ACME_EMAIL in docker-compose.yml
	email {$EOSRIFT_ACME_EMAIL}

	# Restrict on-demand certificates to allowed hostnames.
	# This is configured globally (not inside the site tls block).
	on_demand_tls {
		ask http://server:8080/caddy/ask
	}
}

:80 {
	redir https://{host}{uri}
}

:443 {
	# Avoid wildcard DNS plugins by using on-demand certificates.
	tls {
		on_demand
	}

	# Optional webhook receiver for image-build-triggered deploys.
	@deploy_hook {
		path /hooks/deploy /hooks/deploy/*
	}
	handle @deploy_hook {
		reverse_proxy deployhook:8091
	}

	reverse_proxy server:8080
}
